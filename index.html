<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Sandi Kata - Petualangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Patrick Hand', cursive;
            background-color: #f0fdf4;
            background-image: radial-gradient(#86efac 1px, transparent 1px);
            background-size: 24px 24px;
            touch-action: manipulation;
            overflow-x: hidden; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            display: flex;
            flex-direction: column;
        }

        /* --- LEVEL SELECT STYLES --- */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 12px;
            max-width: 500px;
            margin: 0 auto;
        }

        .level-box {
            aspect-ratio: 1/1;
            background: white;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #4b5563;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-bottom: 4px solid #e5e7eb;
            transition: all 0.1s;
            position: relative;
        }

        .level-box:active { transform: translateY(2px); border-bottom-width: 0px; margin-top: 4px; }
        
        .level-box.locked { 
            background: #f3f4f6; 
            color: #9ca3af; 
            cursor: not-allowed; 
            border-bottom-color: #d1d5db; 
            border: 2px solid #e5e7eb;
        }
        
        .level-box.unlocked { background: #fff; border: 2px solid #d946ef; border-bottom: 4px solid #c026d3; color: #d946ef; }
        .level-box.completed { background: #dcfce7; border-color: #22c55e; color: #15803d; }

        .stars-container { display: flex; gap: 2px; margin-top: 2px; font-size: 0.6rem; }

        /* --- GAME INPUT STYLES --- */
        .game-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }

        .letter-input {
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            text-align: center;
            text-transform: uppercase;
            color: #d946ef;
            font-weight: bold;
            font-size: 1.6rem;
            width: 100%;
            height: 45px;
            padding: 0;
            margin: 0;
            transition: all 0.2s;
            border-radius: 4px 4px 0 0;
        }
        
        .letter-input:focus { outline: none; border-bottom-color: #d946ef; background-color: rgba(217, 70, 239, 0.1); }
        .letter-input.locked { color: #059669; background-color: rgba(5, 150, 105, 0.1); pointer-events: none; border-bottom-color: #059669; }

        /* --- ANIMATIONS --- */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .star-anim { animation: popIn 0.6s backwards; }
        .star-anim:nth-child(1) { animation-delay: 0.2s; }
        .star-anim:nth-child(2) { animation-delay: 0.4s; }
        .star-anim:nth-child(3) { animation-delay: 0.6s; }

        /* Animasi Bintang Terbang */
        @keyframes flyStar {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.2); opacity: 0; }
        }

        /* --- UTILS --- */
        .hidden-force { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }

        .char-box { width: 34px; margin: 0 1px; display: flex; flex-direction: column; align-items: center; }
        .word-wrapper { display: flex; margin-right: 14px; margin-bottom: 10px; }
        
        /* Posisi Tombol Pengaturan */
        #settings-btn {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 9000;
        }

        /* Posisi Bintang Total */
        #star-display-fixed {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 9000;
            transition: transform 0.2s;
        }

        /* Range Slider Custom Style */
        input[type=range] {
            height: 6px;
            border-radius: 5px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            border: 2px solid currentColor;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Accordion Style */
        .audio-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .audio-details.open {
            max-height: 200px;
        }

        @media (min-width: 640px) {
            .char-box { width: 48px; margin: 0 3px; }
            .letter-input { font-size: 2.2rem; height: 55px; }
            .level-grid { grid-template-columns: repeat(5, 1fr); max-width: 600px; gap: 20px; }
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">

    <!-- DISPLAY BINTANG TOTAL (POJOK KIRI ATAS) -->
    <div id="star-display-fixed" class="flex items-center gap-2 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border-2 border-yellow-400 transform hover:scale-105 transition-transform duration-300">
        <i class="fa-solid fa-star text-yellow-500 text-xl animate-[spin_4s_linear_infinite]"></i>
        <span id="total-stars-fixed" class="font-bold text-gray-700 text-xl font-sans">0</span>
    </div>

    <!-- TOMBOL PENGATURAN (POJOK KANAN ATAS) -->
    <button id="settings-btn" onclick="openSettings()" class="bg-white p-3 rounded-full shadow-lg border-2 hover:bg-gray-50 transition transform hover:scale-105 active:scale-95 flex items-center justify-center w-12 h-12 text-gray-600">
        <i class="fa-solid fa-gear text-xl"></i>
    </button>

    <!-- ================= HALAMAN HOME (LEVEL SELECT) ================= -->
    <div id="home-screen" class="flex-grow flex flex-col items-center justify-center p-4 relative pt-24">
        <div class="text-center mb-8 animate-pop">
            <h1 class="text-5xl md:text-6xl font-bold text-purple-600 mb-2 drop-shadow-sm" style="text-shadow: 2px 2px 0px #fff;">SANDI KATA</h1>
            <p class="text-gray-500 font-bold tracking-wider text-sm bg-white/60 px-4 py-1 rounded-full inline-block">Kumpulkan Bintang untuk Membuka Gembok!</p>
        </div>

        <div class="bg-white/70 backdrop-blur-md p-6 rounded-3xl shadow-xl w-full max-w-2xl border border-white/60">
            <div id="level-container" class="level-grid">
                <!-- Grid Level digenerate JS -->
            </div>
        </div>

        <button onclick="openResetModal()" class="mt-8 px-4 py-2 text-xs text-gray-400 hover:text-red-500 font-bold border border-transparent hover:border-red-200 rounded-full transition">
            <i class="fa-solid fa-trash mr-1"></i> Reset Data Permainan
        </button>
    </div>

    <!-- ================= HALAMAN GAME ================= -->
    <div id="game-screen" class="min-h-screen flex flex-col items-center justify-center p-2 md:p-4 hidden-force pt-12">
        <div class="game-card max-w-4xl w-full shadow-2xl rounded-[2rem] p-5 md:p-8 border border-white/50 relative">
            
            <!-- Header Game -->
            <div class="flex justify-between items-start mb-6 pb-2 border-b border-gray-100">
                <button onclick="backToHome()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-2 rounded-xl font-bold text-sm transition flex items-center gap-2">
                    <i class="fa-solid fa-arrow-left"></i> Menu
                </button>
                <div class="flex flex-col items-end pr-10"> 
                    <span id="level-title" class="text-2xl font-bold text-purple-600 leading-none">Level 1</span>
                    <span id="difficulty-badge" class="text-xs font-bold px-2 py-1 rounded bg-green-100 text-green-600 mt-1">
                        Mudah
                    </span>
                    <div class="text-[10px] text-gray-400 mt-1">Target: Min 2 Bintang</div>
                </div>
            </div>

            <!-- Pesan Rahasia -->
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-2xl border border-indigo-100 mb-6 relative shadow-inner">
                <div class="absolute -top-3 left-4 bg-indigo-500 text-white px-3 py-0.5 rounded-full text-xs font-bold shadow-md">PESAN RAHASIA</div>
                <div id="quote-container" class="flex flex-wrap justify-center mt-3"></div>
            </div>

            <!-- Petunjuk -->
            <div class="space-y-3 mb-20 overflow-y-auto max-h-[45vh] md:max-h-none pr-1 custom-scroll">
                <div id="clues-container" class="grid grid-cols-1 gap-3"></div>
            </div>

            <!-- Footer Controls -->
            <div class="absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur px-4 py-4 rounded-b-[2rem] border-t border-gray-100 flex justify-between items-center z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                
                <!-- Info Kesalahan -->
                <div class="flex flex-col mr-2">
                    <span class="text-[10px] text-gray-400 font-bold uppercase">Salah</span>
                    <span id="mistake-counter" class="text-xl font-bold text-gray-700">0</span>
                </div>

                <!-- Tombol Bantuan -->
                <div class="flex gap-2">
                    <button id="hint-btn" onclick="useHint()" class="bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded-full font-bold shadow-lg active:scale-95 transition flex items-center gap-1">
                        <i class="fa-solid fa-lightbulb"></i> <span id="hint-count">5</span>
                    </button>

                    <button onclick="checkAnswer()" class="bg-gradient-to-r from-purple-600 to-pink-500 text-white px-6 py-2 rounded-full font-bold shadow-lg hover:shadow-purple-500/40 hover:-translate-y-1 active:scale-95 transition flex items-center gap-2 text-sm md:text-base">
                        CEK <i class="fa-solid fa-check"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER COPYRIGHT -->
    <footer class="text-center p-4 text-xs text-gray-400 font-bold mt-auto">
        &copy; Riyan 2025
    </footer>

    <!-- ================= MODALS ================= -->

    <!-- Modal Pengaturan -->
    <div id="settings-modal" class="modal-overlay hidden-force" style="z-index: 9500;">
        <div class="bg-white p-6 rounded-3xl text-center shadow-2xl max-w-xs w-full animate-pop">
            <h3 class="font-bold text-2xl text-gray-800 mb-6 border-b pb-2">Pengaturan</h3>
            
            <div class="space-y-3">
                <!-- Section Audio (Accordion) -->
                <div class="bg-gray-50 rounded-xl border border-gray-200 overflow-hidden">
                    <button id="audio-accordion-btn" class="w-full flex items-center justify-between p-3 bg-white hover:bg-gray-50 transition border-b border-gray-100">
                        <div class="flex items-center gap-2">
                            <i id="audio-icon-main" class="fa-solid fa-volume-high text-green-500 text-lg"></i>
                            <span class="font-bold text-gray-700 text-sm">Suara & Musik</span>
                        </div>
                        <i id="audio-chevron" class="fa-solid fa-chevron-down text-gray-400 text-xs transition-transform duration-300"></i>
                    </button>
                    <div id="audio-sliders-panel" class="audio-details bg-gray-50 px-3">
                        <div class="py-3 space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-bold text-gray-500">Status Suara</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="master-mute-toggle" class="sr-only peer" checked>
                                    <div class="w-9 h-5 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-500"></div>
                                </label>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                                    <span>Musik Latar</span>
                                    <span id="bgm-val-display" class="text-purple-600">20%</span>
                                </div>
                                <input type="range" id="bgm-slider" min="0" max="100" value="20" class="w-full accent-purple-500 bg-gray-200 h-1.5 rounded-lg cursor-pointer">
                            </div>
                            <div>
                                <div class="flex justify-between text-xs font-bold text-gray-500 mb-1">
                                    <span>Efek Suara</span>
                                    <span id="sfx-val-display" class="text-pink-600">80%</span>
                                </div>
                                <input type="range" id="sfx-slider" min="0" max="100" value="80" class="w-full accent-pink-500 bg-gray-200 h-1.5 rounded-lg cursor-pointer">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <button onclick="openInfoModal()" class="w-full flex items-center justify-between bg-blue-50 p-3 rounded-xl hover:bg-blue-100 transition text-blue-700 border border-blue-200">
                    <span class="font-bold text-sm"><i class="fa-solid fa-circle-question mr-2"></i> Cara Bermain</span>
                    <i class="fa-solid fa-chevron-right text-xs"></i>
                </button>
                <button onclick="openAboutModal()" class="w-full flex items-center justify-between bg-purple-50 p-3 rounded-xl hover:bg-purple-100 transition text-purple-700 border border-purple-200">
                    <span class="font-bold text-sm"><i class="fa-solid fa-info-circle mr-2"></i> Tentang</span>
                    <i class="fa-solid fa-chevron-right text-xs"></i>
                </button>
            </div>
            <button onclick="closeSettings()" class="mt-6 w-full bg-gray-800 text-white py-3 rounded-xl font-bold hover:bg-gray-700 transition">Tutup</button>
        </div>
    </div>

    <!-- Modal Info & About -->
    <div id="info-modal" class="modal-overlay hidden-force" style="z-index: 9600;">
        <div class="bg-white p-6 rounded-3xl shadow-2xl max-w-sm w-full animate-pop relative">
            <button onclick="closeInfoModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <h3 class="font-bold text-2xl text-purple-600 mb-4 text-center">Cara Bermain</h3>
            <ul class="space-y-3 text-sm text-gray-600 text-left">
                <li class="flex items-start"><span class="bg-purple-100 text-purple-600 rounded-full w-6 h-6 flex items-center justify-center font-bold mr-2 text-xs flex-shrink-0">1</span> Setiap angka mewakili satu huruf yang sama.</li>
                <li class="flex items-start"><span class="bg-purple-100 text-purple-600 rounded-full w-6 h-6 flex items-center justify-center font-bold mr-2 text-xs flex-shrink-0">2</span> Isi kotak kosong berdasarkan petunjuk gambar dan pertanyaan.</li>
                <li class="flex items-start"><span class="bg-purple-100 text-purple-600 rounded-full w-6 h-6 flex items-center justify-center font-bold mr-2 text-xs flex-shrink-0">3</span> Huruf yang kamu isi akan otomatis muncul di kotak lain dengan angka yang sama.</li>
                <li class="flex items-start"><span class="bg-purple-100 text-purple-600 rounded-full w-6 h-6 flex items-center justify-center font-bold mr-2 text-xs flex-shrink-0">4</span> Hindari kesalahan untuk mendapatkan 3 Bintang!</li>
            </ul>
            <div class="mt-6 bg-green-50 p-3 rounded-lg border border-green-100 text-center"><p class="text-xs text-green-700 font-bold">Tips: Kotak hijau adalah huruf bantuan.</p></div>
            <button onclick="closeInfoModal()" class="mt-6 w-full bg-purple-600 text-white py-2 rounded-xl font-bold">Mengerti</button>
        </div>
    </div>

    <!-- MODAL TENTANG (UPDATED) -->
    <div id="about-modal" class="modal-overlay hidden-force" style="z-index: 9700;">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-xs w-full animate-pop relative text-center">
            <button onclick="closeAboutModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-2xl"></i></button>
            <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full mx-auto flex items-center justify-center mb-4 shadow-lg text-white text-3xl font-bold"><i class="fa-solid fa-gamepad"></i></div>
            <h3 class="font-bold text-2xl text-gray-800 mb-1">Sandi Kata</h3>
            <p class="text-xs text-purple-500 font-bold mb-4 bg-purple-50 inline-block px-3 py-1 rounded-full">Versi 1.0.0</p>
            <div class="space-y-3 text-sm text-gray-600 border-t pt-4 border-gray-100">
                <div class="flex justify-between"><span class="text-gray-400">Pembuat</span><span class="font-bold text-gray-800">Riyan</span></div>
                <div class="flex justify-between"><span class="text-gray-400">Asal</span><span class="font-bold text-gray-800 text-right">Sumatera Utara,<br>Indonesia ğŸ‡®ğŸ‡©</span></div>
                <div class="flex justify-between"><span class="text-gray-400">Rilis</span><span class="font-bold text-gray-800">2025</span></div>
            </div>
            
            <!-- TOMBOL WA -->
            <a href="https://wa.me/6282275894842?text=Saya%20sudah%20memainkan%20permainan%20Sandi%20Kata.%20Saya%20ingin%20membuat%20kritik%20dan%20saran%3A...." target="_blank" class="mt-6 flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white py-2 rounded-xl font-bold text-sm w-full transition shadow-md">
                <i class="fa-brands fa-whatsapp text-lg"></i> Kritik & Saran
            </a>

            <div class="mt-4 text-xs text-gray-400">Terima kasih telah bermain!<br>Dibuat dengan â¤ï¸ untuk edukasi.</div>
        </div>
    </div>

    <!-- Modal Menang -->
    <div id="win-modal" class="modal-overlay hidden-force">
        <div class="bg-white p-8 rounded-3xl text-center shadow-2xl max-w-sm w-full animate-pop relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none" style="background-image: radial-gradient(#FFD700 2px, transparent 2px); background-size: 20px 20px;"></div>
            <div id="result-emoji" class="text-7xl mb-2 filter drop-shadow-md">ğŸ‰</div>
            <h2 id="result-title" class="text-2xl font-bold text-gray-800 mb-1">LEVEL SELESAI</h2>
            <div class="flex justify-center gap-2 mb-4 text-4xl py-2" id="modal-stars"></div>
            <p id="result-msg" class="text-gray-500 mb-6 text-sm font-medium">Kamu butuh minimal 2 bintang untuk lanjut.</p>
            <div class="flex flex-col gap-3">
                <button id="btn-next-level" onclick="nextLevel()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-bold shadow-md hover:shadow-lg transition hidden-force">Lanjut Level Berikutnya <i class="fa-solid fa-forward ml-1"></i></button>
                <button onclick="restartLevel()" class="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-200 transition"><i class="fa-solid fa-rotate-right mr-1"></i> Main Ulang</button>
                <button onclick="backToHome()" class="w-full text-gray-400 text-sm font-bold py-2 hover:text-gray-600">Kembali ke Menu</button>
            </div>
        </div>
    </div>

    <!-- Modal Helpers -->
    <div id="error-toast-wrapper" class="modal-overlay hidden-force" style="z-index: 110;">
        <div class="bg-white px-8 py-6 rounded-3xl shadow-2xl flex flex-col items-center border-b-4 border-red-500 min-w-[280px] animate-pop max-w-xs">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-xmark text-3xl text-red-500"></i></div>
            <h3 class="font-bold text-xl text-gray-800">Ups! Masih Salah</h3>
            <p class="text-gray-500 text-sm mt-1 mb-4 text-center">Ada <b id="toast-count" class="text-red-500 text-lg"></b> kotak yang belum tepat.</p>
            <button onclick="closeToast()" class="w-full bg-red-500 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-red-600 transition shadow-md">Coba Perbaiki</button>
        </div>
    </div>
    <div id="info-toast-wrapper" class="modal-overlay hidden-force" style="z-index: 9700;">
        <div class="bg-white px-8 py-6 rounded-3xl shadow-2xl flex flex-col items-center border-b-4 border-blue-500 min-w-[280px] animate-pop max-w-xs">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-info text-3xl text-blue-500"></i></div>
            <h3 class="font-bold text-xl text-gray-800">Info</h3>
            <p id="info-msg" class="text-gray-500 text-sm mt-1 mb-4 text-center">Pesan Info</p>
            <button onclick="closeInfoToast()" class="w-full bg-blue-500 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-blue-600 transition shadow-md">Mengerti</button>
        </div>
    </div>
    <div id="reset-modal" class="modal-overlay hidden-force" style="z-index: 120;">
        <div class="bg-white p-6 rounded-3xl text-center shadow-2xl max-w-xs w-full animate-pop border-t-4 border-red-500">
            <div class="text-5xl mb-3">âš ï¸</div>
            <h3 class="font-bold text-xl text-gray-800">Hapus Semua Data?</h3>
            <p class="text-gray-500 text-sm mb-6">Progress level dan bintang akan hilang permanen.</p>
            <div class="flex gap-3">
                <button onclick="closeResetModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-xl font-bold">Batal</button>
                <button onclick="confirmReset()" class="flex-1 bg-red-500 text-white py-2 rounded-xl font-bold">Hapus</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA POOL (50 LEVEL - VARIED CLUES) ---
        const LEVEL_DATA = [
            // LEVEL 1-10 (Mudah, 3 Clues)
            { quote: "BHINNEKA TUNGGAL IKA", clues: [{icon:"ğŸ¦…",q:"Lambang Negara",a:"GARUDA"}, {icon:"ğŸï¸",q:"Pulau Dewata",a:"BALI"}, {icon:"ğŸ‘…",q:"Indra Pengecap",a:"LIDAH"}] },
            { quote: "RAJIN PANGKAL PANDAI", clues: [{icon:"ğŸ¦",q:"Raja Hutan",a:"SINGA"}, {icon:"ğŸŒ§ï¸",q:"Air Langit",a:"HUJAN"}, {icon:"ğŸšª",q:"Akses Masuk",a:"PINTU"}] },
            { quote: "BERAKIT KE HULU", clues: [{icon:"ğŸ›¶",q:"Perahu Kayu",a:"RAKIT"}, {icon:"ğŸŸ",q:"Bernapas Insang",a:"IKAN"}, {icon:"â›°ï¸",q:"Dataran Tinggi",a:"BUKIT"}] },
            { quote: "HEMAT PANGKAL KAYA", clues: [{icon:"ğŸ’°",q:"Wadah Uang",a:"DOMPET"}, {icon:"ğŸŒ™",q:"Cahaya Malam",a:"BULAN"}, {icon:"ğŸ‘€",q:"Indra Penglihat",a:"MATA"}] },
            { quote: "MAJU TAK GENTAR", clues: [{icon:"âš”ï¸",q:"Senjata Tajam",a:"PEDANG"}, {icon:"ğŸ”´",q:"Warna Darah",a:"MERAH"}, {icon:"ğŸ‘£",q:"Anggota Gerak",a:"KAKI"}] },
            { quote: "AIR BERIAK TANDA TAK DALAM", clues: [{icon:"ğŸŒŠ",q:"Gelombang Air",a:"OMBAK"}, {icon:"âš“",q:"Parkir Kapal",a:"JANGKAR"}, {icon:"ğŸš¢",q:"Kendaraan Laut",a:"KAPAL"}] },
            { quote: "DIMANA BUMI DIPIJAK", clues: [{icon:"ğŸŒ",q:"Planet Kita",a:"BUMI"}, {icon:"ğŸ‘",q:"Alas Kaki",a:"SEPATU"}, {icon:"â˜ï¸",q:"Gumpalan Air",a:"AWAN"}] },
            { quote: "SEDIKIT LAMA LAMA MENJADI BUKIT", clues: [{icon:"ğŸœ",q:"Hewan Kecil",a:"SEMUT"}, {icon:"â³",q:"Penunjuk Waktu",a:"JAM"}, {icon:"ğŸ”ï¸",q:"Gunung Kecil",a:"BUKIT"}] },
            { quote: "BERSATU KITA TEGUH", clues: [{icon:"ğŸ¤",q:"Sapaan Tangan",a:"SALAM"}, {icon:"ğŸ ",q:"Tempat Tinggal",a:"RUMAH"}, {icon:"ğŸŒ³",q:"Tumbuhan Kayu",a:"POHON"}] },
            { quote: "TUT WURI HANDAYANI", clues: [{icon:"ğŸ«",q:"Tempat Belajar",a:"SEKOLAH"}, {icon:"ğŸ“š",q:"Jendela Dunia",a:"BUKU"}, {icon:"âœï¸",q:"Alat Tulis",a:"PENSIL"}] },
            
            // LEVEL 11-20 (Menengah, 4 Clues)
            { quote: "BERENANG RENANG KE TEPIAN", clues: [{icon:"ğŸŠ",q:"Olahraga Air",a:"RENANG"}, {icon:"ğŸ–ï¸",q:"Pinggir Laut",a:"PANTAI"}, {icon:"ğŸŸ",q:"Ikan Hias",a:"ARWANA"}, {icon:"ğŸš¤",q:"Perahu Cepat",a:"BOAT"}] },
            { quote: "TONG KOSONG NYARING BUNYINYA", clues: [{icon:"ğŸ¥",q:"Alat Musik Pukul",a:"DRUM"}, {icon:"ğŸ””",q:"Bunyi Sekolah",a:"BEL"}, {icon:"ğŸ¦—",q:"Serangga",a:"JANGKRIK"}, {icon:"ğŸ¤",q:"Untuk Nyanyi",a:"MIKROFON"}] },
            { quote: "SEDIA PAYUNG SEBELUM HUJAN", clues: [{icon:"â˜”",q:"Pelindung Hujan",a:"PAYUNG"}, {icon:"ğŸ”¥",q:"Panas Membara",a:"API"}, {icon:"ğŸŒŠ",q:"Air Asin",a:"LAUT"}, {icon:"â˜ï¸",q:"Awan Gelap",a:"MENDUNG"}] },
            { quote: "SEPERTI KATAK DALAM TEMPURUNG", clues: [{icon:"ğŸ¸",q:"Hewan Amfibi",a:"KATAK"}, {icon:"ğŸ¥¥",q:"Buah Santan",a:"KELAPA"}, {icon:"ğŸŒ‘",q:"Gelap Gulita",a:"MALAM"}, {icon:"ğŸ¢",q:"Hewan Cangkang",a:"KURA"}] },
            { quote: "ADA GULA ADA SEMUT", clues: [{icon:"ğŸœ",q:"Suka Manis",a:"SEMUT"}, {icon:"ğŸ¬",q:"Rasa Manis",a:"GULA"}, {icon:"ğŸ",q:"Penghasil Madu",a:"LEBAH"}, {icon:"ğŸ°",q:"Kue Tart",a:"BOLU"}] },
            { quote: "BUAH JATUH TAK JAUH DARI POHONNYA", clues: [{icon:"ğŸ",q:"Makanan Sehat",a:"BUAH"}, {icon:"ğŸŒ²",q:"Hutan Pinus",a:"POHON"}, {icon:"ğŸ‚",q:"Gugur",a:"DAUN"}, {icon:"ğŸŒ±",q:"Tunas",a:"BENIH"}] },
            { quote: "BESAR PASAK DARIPADA TIANG", clues: [{icon:"ğŸ—ï¸",q:"Penyangga",a:"TIANG"}, {icon:"ğŸ”¨",q:"Alat Tukang",a:"PALU"}, {icon:"ğŸ”©",q:"Pasangan Mur",a:"BAUT"}, {icon:"ğŸ ",q:"Atap Rumah",a:"GENTENG"}] },
            { quote: "PADI MAKIN BERISI MAKIN MERUNDUK", clues: [{icon:"ğŸŒ¾",q:"Bahan Nasi",a:"PADI"}, {icon:"ğŸš",q:"Makanan Pokok",a:"NASI"}, {icon:"ğŸ‘¨â€ğŸŒ¾",q:"Orang Sawah",a:"PETANI"}, {icon:"ğŸšœ",q:"Bajak Sawah",a:"TRAKTOR"}] },
            { quote: "ANJING MENGGONGGONG KAFILAH BERLALU", clues: [{icon:"ğŸ•",q:"Hewan Penjaga",a:"ANJING"}, {icon:"ğŸš¶",q:"Berjalan Kaki",a:"JALAN"}, {icon:"ğŸ«",q:"Hewan Gurun",a:"UNTA"}, {icon:"ğŸŒµ",q:"Tanaman Gurun",a:"KAKTUS"}] },
            { quote: "BAGAI PINANG DIBELAH DUA", clues: [{icon:"ğŸŒ´",q:"Pohon Sejenis",a:"PINANG"}, {icon:"âœŒï¸",q:"Angka Jari",a:"DUA"}, {icon:"ğŸ”ª",q:"Alat Potong",a:"PISAU"}, {icon:"ğŸ¥¥",q:"Isi Es Doger",a:"KELAPA"}] },

            // LEVEL 21-30 (Menengah, 4 Clues)
            { quote: "SEPERTI AIR DENGAN MINYAK", clues: [{icon:"ğŸ’§",q:"Cairan Kehidupan",a:"AIR"}, {icon:"ğŸ³",q:"Untuk Goreng",a:"MINYAK"}, {icon:"ğŸ”¥",q:"Lawan Air",a:"API"}, {icon:"ğŸ•¯ï¸",q:"Penerang Lilin",a:"CAHAYA"}] },
            { quote: "KEBERSIHAN SEBAGIAN DARI IMAN", clues: [{icon:"ğŸ§¹",q:"Alat Menyapu",a:"SAPU"}, {icon:"ğŸ—‘ï¸",q:"Tempat Buang",a:"SAMPAH"}, {icon:"ğŸš¿",q:"Mandi",a:"SABUN"}, {icon:"ğŸ•Œ",q:"Tempat Ibadah",a:"MASJID"}] },
            { quote: "MALU BERTANYA SESAT DI JALAN", clues: [{icon:"ğŸ¤”",q:"Sedang Bingung",a:"TANYA"}, {icon:"ğŸ—ºï¸",q:"Penunjuk Arah",a:"PETA"}, {icon:"ğŸ›£ï¸",q:"Jalan Tol",a:"JALAN"}, {icon:"ğŸ§­",q:"Arah Utara",a:"KOMPAS"}] },
            { quote: "MENANG JADI ARANG KALAH JADI ABU", clues: [{icon:"ğŸ”¥",q:"Sisa Bakaran",a:"ABU"}, {icon:"âš«",q:"Warna Gelap",a:"HITAM"}, {icon:"ğŸ†",q:"Juara",a:"MENANG"}, {icon:"ğŸªµ",q:"Bahan Bakar",a:"ARANG"}] },
            { quote: "HABIS MANIS SEPAH DIBUANG", clues: [{icon:"ğŸ¬",q:"Rasa Gula",a:"MANIS"}, {icon:"ğŸ—‘ï¸",q:"Tempat Kotoran",a:"TONG"}, {icon:"ğŸ‘„",q:"Alat Makan",a:"MULUT"}, {icon:"ğŸ­",q:"Permen Batang",a:"LOLLIPOP"}] },
            { quote: "MUSUH DALAM SELIMUT", clues: [{icon:"ğŸ›ï¸",q:"Penghangat",a:"SELIMUT"}, {icon:"âš”ï¸",q:"Lawan Teman",a:"MUSUH"}, {icon:"ğŸ’¤",q:"Istirahat",a:"TIDUR"}, {icon:"ğŸ›Œ",q:"Kasur",a:"BANTAL"}] },
            { quote: "NASI SUDAH MENJADI BUBUR", clues: [{icon:"ğŸ¥£",q:"Nasi Lembek",a:"BUBUR"}, {icon:"ğŸš",q:"Beras Matang",a:"NASI"}, {icon:"ğŸ¥„",q:"Alat Makan",a:"SENDOK"}, {icon:"ğŸ²",q:"Sup Hangat",a:"KUAH"}] },
            { quote: "SENJATA MAKAN TUAN", clues: [{icon:"ğŸ”«",q:"Alat Perang",a:"SENJATA"}, {icon:"ğŸ½ï¸",q:"Aktivitas Mulut",a:"MAKAN"}, {icon:"ğŸ¤´",q:"Raja",a:"TUAN"}, {icon:"ğŸ›¡ï¸",q:"Pelindung",a:"TAMENG"}] },
            { quote: "SETALI TIGA UANG", clues: [{icon:"ğŸ’°",q:"Alat Tukar",a:"UANG"}, {icon:"3ï¸âƒ£",q:"Angka Ganjil",a:"TIGA"}, {icon:"ğŸª™",q:"Uang Logam",a:"KOIN"}, {icon:"ğŸ’µ",q:"Uang Kertas",a:"LEMBAR"}] },
            { quote: "SUDAH JATUH TERTIMPA TANGGA", clues: [{icon:"ğŸªœ",q:"Alat Panjat",a:"TANGGA"}, {icon:"ğŸ¤•",q:"Sakit Kepala",a:"PUSING"}, {icon:"â¬‡ï¸",q:"Arah Bawah",a:"TURUN"}, {icon:"ğŸ©¹",q:"P3K",a:"PERBAN"}] },

            // LEVEL 31-40 (Sulit, 5 Clues)
            { quote: "TAK ADA GADING YANG TAK RETAK", clues: [{icon:"ğŸ˜",q:"Hewan Belalai",a:"GAJAH"}, {icon:"ğŸ¦´",q:"Bagian Keras",a:"TULANG"}, {icon:"ğŸ¥š",q:"Mudah Pecah",a:"TELUR"}, {icon:"ğŸ”¨",q:"Pukul Paku",a:"PALU"}, {icon:"ğŸ¦·",q:"Gigi Putih",a:"GADING"}] },
            { quote: "AIR SUSU DIBALAS AIR TUBA", clues: [{icon:"ğŸ¥›",q:"Minuman Sehat",a:"SUSU"}, {icon:"ğŸ„",q:"Penghasil Susu",a:"SAPI"}, {icon:"â˜ ï¸",q:"Tanda Bahaya",a:"RACUN"}, {icon:"ğŸ¼",q:"Botol Bayi",a:"DOT"}, {icon:"ğŸ§ª",q:"Cairan Kimia",a:"TUBA"}] },
            { quote: "JAUH DI MATA DEKAT DI HATI", clues: [{icon:"ğŸ‘€",q:"Indra Penglihat",a:"MATA"}, {icon:"â¤ï¸",q:"Organ Perasa",a:"HATI"}, {icon:"ğŸ”­",q:"Melihat Jauh",a:"TEROPONG"}, {icon:"ğŸ‘“",q:"Alat Baca",a:"KACAMATA"}, {icon:"ğŸ’“",q:"Detak",a:"JANTUNG"}] },
            { quote: "LEMPAR BATU SEMBUNYI TANGAN", clues: [{icon:"ğŸª¨",q:"Benda Keras",a:"BATU"}, {icon:"âœ‹",q:"Anggota Tubuh",a:"TANGAN"}, {icon:"ğŸ™ˆ",q:"Tidak Lihat",a:"SEMBUNYI"}, {icon:"âš¾",q:"Lempar Bola",a:"BASEBALL"}, {icon:"ğŸ§¤",q:"Sarung Tangan",a:"GLOVE"}] },
            { quote: "PANDAI MEMBUNGKUS YANG BUSUK", clues: [{icon:"ğŸ",q:"Hadiah",a:"KADO"}, {icon:"ğŸ¤¢",q:"Bau Tak Sedap",a:"BUSUK"}, {icon:"ğŸ§ ",q:"Organ Pikir",a:"OTAK"}, {icon:"ğŸ“¦",q:"Kardus",a:"KOTAK"}, {icon:"ğŸ—‘ï¸",q:"Sampah",a:"LIMBAH"}] },
            { quote: "SEPANDAI PANDAI TUPAI MELOMPAT", clues: [{icon:"ğŸ¿ï¸",q:"Hewan Pengerat",a:"TUPAI"}, {icon:"ğŸ¦˜",q:"Hewan Australia",a:"KANGURU"}, {icon:"ğŸŒ²",q:"Tempat Tupai",a:"POHON"}, {icon:"ğŸ‡",q:"Lompat",a:"KELINCI"}, {icon:"ğŸ¥œ",q:"Makanan Tupai",a:"KENARI"}] },
            { quote: "DIMANA ADA KEMAUAN DISITU ADA JALAN", clues: [{icon:"ğŸ›£ï¸",q:"Tempat Kendaraan",a:"JALAN"}, {icon:"ğŸ§ ",q:"Ingin Sesuatu",a:"MAU"}, {icon:"ğŸ’ª",q:"Kuat",a:"KUAT"}, {icon:"ğŸš—",q:"Mobil",a:"RODA"}, {icon:"ğŸ",q:"Garis Akhir",a:"FINISH"}] },
            { quote: "LAIN LADANG LAIN BELALANG", clues: [{icon:"ğŸ¦—",q:"Serangga Hijau",a:"BELALANG"}, {icon:"ğŸŒ¾",q:"Tempat Tanam",a:"LADANG"}, {icon:"ğŸŸ",q:"Lain Lubuk...",a:"IKAN"}, {icon:"ğŸ¦‹",q:"Serangga Cantik",a:"KUPU"}, {icon:"ğŸ›",q:"Ulat",a:"KEPOMPONG"}] },
            { quote: "SAMBIL MENYELAM MINUM AIR", clues: [{icon:"ğŸ¤¿",q:"Berenang Dalam",a:"SELAM"}, {icon:"ğŸ¥¤",q:"Melepas Dahaga",a:"MINUM"}, {icon:"ğŸ’§",q:"Zat Cair",a:"AIR"}, {icon:"ğŸŒŠ",q:"Ombak",a:"GELOMBANG"}, {icon:"ğŸŸ",q:"Bernapas Air",a:"INSANG"}] },
            { quote: "SIAPA CEPAT DIA DAPAT", clues: [{icon:"ğŸƒ",q:"Lari Kencang",a:"CEPAT"}, {icon:"ğŸ",q:"Terima Sesuatu",a:"DAPAT"}, {icon:"ğŸ¥‡",q:"Juara Satu",a:"EMAS"}, {icon:"ğŸï¸",q:"Balapan",a:"RACING"}, {icon:"â±ï¸",q:"Waktu",a:"DETIK"}] },

            // LEVEL 41-50 (Sangat Sulit, 5 Clues)
            { quote: "TIADA ROTAN AKAR PUN JADI", clues: [{icon:"ğŸª‘",q:"Kursi Anyam",a:"ROTAN"}, {icon:"ğŸŒ³",q:"Bawah Pohon",a:"AKAR"}, {icon:"ğŸªµ",q:"Batang",a:"KAYU"}, {icon:"ğŸŒ¿",q:"Tanaman",a:"TUMBUHAN"}, {icon:"ğŸ‹",q:"Bambu",a:"BULUH"}] },
            { quote: "BAGAI AIR DI DAUN TALAS", clues: [{icon:"ğŸƒ",q:"Bagian Tanaman",a:"DAUN"}, {icon:"ğŸ’§",q:"Benda Cair",a:"AIR"}, {icon:"ğŸŒ±",q:"Tanaman Umbi",a:"TALAS"}, {icon:"â˜”",q:"Anti Air",a:"KALIS"}, {icon:"ğŸŒ¿",q:"Hijau",a:"KLOROFIL"}] },
            { quote: "BURUK MUKA CERMIN DIBELAH", clues: [{icon:"ğŸª",q:"Alat Berkaca",a:"CERMIN"}, {icon:"ğŸª“",q:"Membelah Kayu",a:"KAPAK"}, {icon:"ğŸ˜¡",q:"Wajah Marah",a:"MUKA"}, {icon:"ğŸ‘¹",q:"Seram",a:"HANTU"}, {icon:"ğŸ’”",q:"Patah Hati",a:"RETAK"}] },
            { quote: "DARIPADA HUJAN EMAS DI NEGERI ORANG", clues: [{icon:"ğŸŒ§ï¸",q:"Turun Air",a:"HUJAN"}, {icon:"ğŸ¥‡",q:"Logam Mulia",a:"EMAS"}, {icon:"ğŸ™ï¸",q:"Tempat Tinggal",a:"NEGERI"}, {icon:"ğŸ‘‘",q:"Raja",a:"MAHKOTA"}, {icon:"ğŸŒ",q:"Dunia",a:"GLOBAL"}] },
            { quote: "GALI LUBANG TUTUP LUBANG", clues: [{icon:"ğŸ•³ï¸",q:"Tanah Bolong",a:"LUBANG"}, {icon:"â›ï¸",q:"Alat Gali",a:"CANGKUL"}, {icon:"ğŸšª",q:"Buka Lawannya",a:"TUTUP"}, {icon:"ğŸ’°",q:"Pinjaman",a:"HUTANG"}, {icon:"ğŸšœ",q:"Alat Berat",a:"BEKO"}] },
            { quote: "HANGAT HANGAT TAHI AYAM", clues: [{icon:"ğŸ“",q:"Hewan Berkokok",a:"AYAM"}, {icon:"ğŸ’©",q:"Kotoran",a:"TAHI"}, {icon:"ğŸ”¥",q:"Tidak Dingin",a:"HANGAT"}, {icon:"ğŸ³",q:"Masak Telur",a:"GORENG"}, {icon:"ğŸŒ¡ï¸",q:"Suhu",a:"PANAS"}] },
            { quote: "JANGAN MEMANCING DI AIR KERUH", clues: [{icon:"ğŸ£",q:"Cari Ikan",a:"MANCING"}, {icon:"ğŸŒ«ï¸",q:"Tidak Jernih",a:"KERUH"}, {icon:"ğŸ’§",q:"Tempat Ikan",a:"AIR"}, {icon:"ğŸŸ",q:"Ikan Lele",a:"KUMIS"}, {icon:"ğŸª£",q:"Wadah Air",a:"EMBER"}] },
            { quote: "KACANG LUPA KULITNYA", clues: [{icon:"ğŸ¥œ",q:"Camilan Kulit",a:"KACANG"}, {icon:"ğŸ§¥",q:"Pelindung Tubuh",a:"KULIT"}, {icon:"ğŸ§ ",q:"Tidak Ingat",a:"LUPA"}, {icon:"ğŸŒ°",q:"Biji",a:"BIJI"}, {icon:"ğŸ«",q:"Coklat",a:"ALMOND"}] },
            { quote: "LEBIH BAIK SATU BURUNG DI TANGAN", clues: [{icon:"ğŸ¦",q:"Hewan Terbang",a:"BURUNG"}, {icon:"âœ‹",q:"Jari Lima",a:"TANGAN"}, {icon:"1ï¸âƒ£",q:"Angka Awal",a:"SATU"}, {icon:"ğŸ¦…",q:"Garuda",a:"ELANG"}, {icon:"ğŸ¥š",q:"Anak Burung",a:"TELUR"}] },
            { quote: "RUMPUT TETANGGA LEBIH HIJAU", clues: [{icon:"ğŸŒ±",q:"Tanaman Pendek",a:"RUMPUT"}, {icon:"ğŸ ",q:"Sebelah Rumah",a:"TETANGGA"}, {icon:"ğŸŸ¢",q:"Warna Daun",a:"HIJAU"}, {icon:"ğŸ®",q:"Makan Rumput",a:"SAPI"}, {icon:"ğŸ¡",q:"Halaman",a:"TAMAN"}] }
        ];

        // --- GAME STATE ---
        let userProgress = JSON.parse(localStorage.getItem('sandiKataProgress')) || { unlockedLevel: 1, stars: {} };
        let audioPrefs = JSON.parse(localStorage.getItem('sandiKataAudio')) || { isMuted: false, bgmVolume: 20, sfxVolume: 80 };
        let currentLevelIdx = 0, currentMistakes = 0, charToNumberMap = {};
        let audioCtx = null;
        let hintsRemaining = 5;
        let lastFocusedInput = null;

        // --- AUDIO ENGINE ---
        function initAudioEngine() { if(!audioCtx) { const AudioContext = window.AudioContext || window.webkitAudioContext; audioCtx = new AudioContext(); } if(audioCtx.state === 'suspended') audioCtx.resume(); }
        function playTone(freq, type, duration, vol = 0.5, startTime = null) {
            if(audioPrefs.isMuted || !audioCtx) return;
            const sfxGain = audioPrefs.sfxVolume / 100; const finalVol = vol * sfxGain; if(finalVol <= 0.01) return; 
            const start = startTime || audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, start); gain.gain.setValueAtTime(finalVol, start);
            gain.gain.exponentialRampToValueAtTime(0.01, start + duration); osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(start); osc.stop(start + duration);
        }
        function playClickSound() { playTone(800, 'sine', 0.1, 0.4); } 
        function playTypeSound() { playTone(1200, 'square', 0.05, 0.2); } 
        function playBuzzer() {
            if(audioPrefs.isMuted || !audioCtx) return; const sfxGain = audioPrefs.sfxVolume / 100; const finalVol = 0.5 * sfxGain; if(finalVol <= 0.01) return;
            const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(80, now + 0.3); gain.gain.setValueAtTime(finalVol, now);
            gain.gain.linearRampToValueAtTime(0.01, now + 0.3); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(now + 0.3);
        }
        function playNotification() {
            if(audioPrefs.isMuted || !audioCtx) return; const sfxGain = audioPrefs.sfxVolume / 100; const finalVol = 0.4 * sfxGain; if(finalVol <= 0.01) return;
            const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sine';
            osc.frequency.setValueAtTime(500, now); osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1); gain.gain.setValueAtTime(finalVol, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(now + 0.5);
        }
        function playDeleteSound() {
            if(audioPrefs.isMuted || !audioCtx) return; const sfxGain = audioPrefs.sfxVolume / 100; const finalVol = 0.4 * sfxGain; if(finalVol <= 0.01) return;
            const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(400, now); osc.frequency.exponentialRampToValueAtTime(100, now + 0.2); gain.gain.setValueAtTime(finalVol, now);
            gain.gain.linearRampToValueAtTime(0.01, now + 0.2); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(now + 0.2);
        }
        function playWinTune() {
            if(audioPrefs.isMuted || !audioCtx) return; const sfxGain = audioPrefs.sfxVolume / 100; const vol = 0.4 * sfxGain; if(vol <= 0.01) return;
            const now = audioCtx.currentTime; playTone(523.25, 'sine', 0.15, vol, now); playTone(659.25, 'sine', 0.15, vol, now + 0.1); 
            playTone(783.99, 'sine', 0.15, vol, now + 0.2); playTone(1046.50, 'sine', 0.4, vol, now + 0.3); 
        }
        function playAlertSound() {
            if(audioPrefs.isMuted || !audioCtx) return; const sfxGain = audioPrefs.sfxVolume / 100; const vol = 0.3 * sfxGain; if(vol <= 0.01) return;
            const now = audioCtx.currentTime; playTone(600, 'square', 0.1, vol, now); playTone(600, 'square', 0.1, vol, now + 0.15);
        }
        function playPopSound() { if(audioPrefs.isMuted || !audioCtx) return; playTone(700, 'triangle', 0.05, 0.3); }
        function playUnlockSound() { if(audioPrefs.isMuted||!audioCtx) return; const sfxGain=audioPrefs.sfxVolume/100; const now=audioCtx.currentTime; playTone(1200,'sine',0.1,0.4*sfxGain,now); playTone(1500,'sine',0.2,0.4*sfxGain,now+0.1); }

        const bgm = new Audio("https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3");
        bgm.loop = true;
        
        function updateBgmVolume() { if (audioPrefs.isMuted) bgm.volume = 0; else bgm.volume = (audioPrefs.bgmVolume / 100) * 0.4; }

        document.addEventListener('click', (event) => {
            initAudioEngine();
            if(!audioPrefs.isMuted && bgm.paused) { updateBgmVolume(); bgm.play().catch(() => {}); }
            if(!event.target.matches('input[type="range"]')) playClickSound();
        });

        window.onload = function() {
            renderLevelGrid();
            document.getElementById('bgm-slider').value = audioPrefs.bgmVolume;
            document.getElementById('bgm-val-display').innerText = audioPrefs.bgmVolume + '%';
            document.getElementById('sfx-slider').value = audioPrefs.sfxVolume;
            document.getElementById('sfx-val-display').innerText = audioPrefs.sfxVolume + '%';
            document.getElementById('master-mute-toggle').checked = !audioPrefs.isMuted;
            updateAudioIconUI(); updateBgmVolume();
            if(!audioPrefs.isMuted && audioPrefs.bgmVolume > 0) bgm.play().catch(() => console.log("Auto play blocked"));
        };

        function saveAudioPrefs() { localStorage.setItem('sandiKataAudio', JSON.stringify(audioPrefs)); }

        // --- SETTINGS LOGIC ---
        function openSettings() { playPopSound(); document.getElementById('settings-modal').classList.remove('hidden-force'); }
        function closeSettings() { playPopSound(); document.getElementById('settings-modal').classList.add('hidden-force'); }
        function openInfoModal() { playPopSound(); document.getElementById('info-modal').classList.remove('hidden-force'); }
        function closeInfoModal() { playPopSound(); document.getElementById('info-modal').classList.add('hidden-force'); }
        function openAboutModal() { playPopSound(); document.getElementById('about-modal').classList.remove('hidden-force'); }
        function closeAboutModal() { playPopSound(); document.getElementById('about-modal').classList.add('hidden-force'); }

        const bgmSlider = document.getElementById('bgm-slider'); const sfxSlider = document.getElementById('sfx-slider');
        const audioAccordionBtn = document.getElementById('audio-accordion-btn'); const audioSlidersPanel = document.getElementById('audio-sliders-panel');
        const masterMuteToggle = document.getElementById('master-mute-toggle');

        audioAccordionBtn.addEventListener('click', (e) => {
            e.stopPropagation(); const panel = audioSlidersPanel; const icon = document.getElementById('audio-chevron');
            if (panel.style.maxHeight) { panel.style.maxHeight = null; icon.style.transform = "rotate(0deg)"; } 
            else { panel.style.maxHeight = panel.scrollHeight + "px"; icon.style.transform = "rotate(180deg)"; }
        });

        bgmSlider.addEventListener('input', function() { audioPrefs.bgmVolume = this.value; document.getElementById('bgm-val-display').innerText = this.value + '%'; updateBgmVolume(); saveAudioPrefs(); });
        sfxSlider.addEventListener('input', function() { audioPrefs.sfxVolume = this.value; document.getElementById('sfx-val-display').innerText = this.value + '%'; saveAudioPrefs(); });
        sfxSlider.addEventListener('change', function() { playTypeSound(); });
        masterMuteToggle.addEventListener('change', (e) => { e.stopPropagation(); toggleMuteState(); });

        function toggleMuteState() {
            audioPrefs.isMuted = !audioPrefs.isMuted; initAudioEngine(); updateAudioIconUI();
            if(audioPrefs.isMuted) { bgm.pause(); document.getElementById('master-mute-toggle').checked = false; } 
            else { updateBgmVolume(); bgm.play().catch(() => {}); playNotification(); document.getElementById('master-mute-toggle').checked = true; }
            saveAudioPrefs();
        }
        function updateAudioIconUI() { const iconMain = document.getElementById('audio-icon-main'); if(audioPrefs.isMuted) iconMain.className = "fa-solid fa-volume-xmark text-red-400 text-lg"; else iconMain.className = "fa-solid fa-volume-high text-green-500 text-lg"; }

        // --- LEVEL LOGIC ---
        function renderLevelGrid() {
            const totalStars = Object.values(userProgress.stars).reduce((a, b) => a + b, 0);
            document.getElementById('total-stars-fixed').innerText = totalStars;
            const container = document.getElementById('level-container'); container.innerHTML = '';
            for (let i = 1; i <= 50; i++) {
                const box = document.createElement('div'); const starsCount = userProgress.stars[i] || 0;
                const requiredStars = (i === 1) ? 0 : (i - 1) * 2; const isUnlocked = totalStars >= requiredStars;
                let classes = "level-box"; let content = "";
                if (!isUnlocked) {
                    classes += " locked";
                    content = `<span class="text-gray-400 text-lg">${i}</span><div class="flex flex-col items-center text-gray-400 mt-1"><i class="fa-solid fa-lock text-xs"></i><span class="text-[9px] leading-tight mt-0.5">Butuh ${requiredStars}â­</span></div>`;
                } else {
                    if (starsCount > 0) classes += " unlocked completed"; else classes += " unlocked";
                    let starsHtml = ''; for(let s=1; s<=3; s++) starsHtml += `<i class="fa-solid fa-star ${s <= starsCount ? 'text-yellow-400' : 'text-gray-300'}"></i>`;
                    content = `<span>${i}</span><div class="stars-container">${starsHtml}</div>`;
                    box.onclick = (e) => { e.stopPropagation(); loadLevel(i); };
                }
                box.className = classes; box.innerHTML = content; container.appendChild(box);
            }
        }

        function updateTotalStarsUI() {
            const totalStars = Object.values(userProgress.stars).reduce((a, b) => a + b, 0);
            document.getElementById('total-stars-fixed').innerText = totalStars;
        }

        function loadLevel(levelNum) {
            currentLevelIdx = levelNum - 1;
            hintsRemaining = 5; 
            document.getElementById('hint-count').innerText = hintsRemaining;
            document.getElementById('hint-btn').classList.remove('opacity-50', 'cursor-not-allowed');
            
            let diffLabel = "";
            let autoHints = 0;

            if (levelNum <= 10) { diffLabel = "Mudah (2 Bantuan)"; autoHints = 2; } 
            else if (levelNum <= 30) { diffLabel = "Sedang (1 Bantuan)"; autoHints = 1; } 
            else { diffLabel = "Sulit (0 Bantuan)"; autoHints = 0; }

            const badge = document.getElementById('difficulty-badge');
            badge.innerText = diffLabel;
            if(levelNum <= 10) badge.className = `text-xs font-bold px-2 py-1 rounded mt-1 bg-green-100 text-green-600`;
            else if(levelNum <= 30) badge.className = `text-xs font-bold px-2 py-1 rounded mt-1 bg-yellow-100 text-yellow-600`;
            else badge.className = `text-xs font-bold px-2 py-1 rounded mt-1 bg-red-100 text-red-600`;

            const levelData = LEVEL_DATA[currentLevelIdx % LEVEL_DATA.length];
            document.getElementById('home-screen').classList.add('hidden-force');
            document.getElementById('game-screen').classList.remove('hidden-force');
            document.getElementById('game-screen').classList.add('flex');
            document.getElementById('level-title').innerText = `Level ${levelNum}`;
            document.getElementById('mistake-counter').innerText = "0";
            document.getElementById('mistake-counter').className = "text-2xl font-bold text-gray-700";
            currentMistakes = 0;
            generateMapping(levelData);
            renderGame(levelData);
            if(autoHints > 0) revealRandomHint(autoHints);
        }

        function generateMapping(data) {
            charToNumberMap = {};
            const fullText = (data.quote + data.clues.map(c => c.a).join('')).toUpperCase().replace(/[^A-Z]/g, '');
            const uniqueChars = [...new Set(fullText.split(''))];
            let numbers = Array.from({length: uniqueChars.length}, (_, i) => i + 1);
            numbers.sort(() => Math.random() - 0.5);
            uniqueChars.forEach((char, i) => { charToNumberMap[char] = numbers[i]; });
        }

        function renderGame(data) {
            const qContainer = document.getElementById('quote-container'); const cContainer = document.getElementById('clues-container');
            qContainer.innerHTML = ''; cContainer.innerHTML = '';
            data.quote.split(' ').forEach(word => {
                const wrap = document.createElement('div'); wrap.className = 'word-wrapper';
                for(let char of word) wrap.appendChild(createBox(char));
                qContainer.appendChild(wrap);
            });
            data.clues.forEach(clue => {
                const row = document.createElement('div');
                row.className = "bg-white p-3 rounded-xl border border-gray-100 flex flex-col sm:flex-row items-start sm:items-center gap-3 shadow-sm";
                row.innerHTML = `<div class="flex items-center gap-3 w-full sm:w-1/3 min-w-[150px]"><div class="text-2xl bg-purple-50 w-10 h-10 flex items-center justify-center rounded-lg">${clue.icon}</div><span class="text-gray-700 font-bold text-sm leading-tight">${clue.q}</span></div>`;
                const inputs = document.createElement('div'); inputs.className = "flex flex-wrap";
                clue.a.split(' ').forEach(word => {
                    const wrap = document.createElement('div'); wrap.className = 'word-wrapper';
                    for(let char of word) wrap.appendChild(createBox(char));
                    inputs.appendChild(wrap);
                });
                row.appendChild(inputs); cContainer.appendChild(row);
            });
        }

        function createBox(char) {
            char = char.toUpperCase(); const num = charToNumberMap[char];
            const div = document.createElement('div'); div.className = 'char-box';
            div.innerHTML = `<input type="text" maxlength="1" class="letter-input" data-number="${num}" data-real="${char}" autocomplete="off" inputmode="text"><span class="text-[0.7rem] font-bold text-gray-400 mt-1">${num}</span>`;
            const inp = div.querySelector('input');
            inp.addEventListener('input', (e) => handleInput(e, inp));
            inp.addEventListener('focus', (e) => { lastFocusedInput = inp; highlightBoxes(num, true); });
            inp.addEventListener('blur', () => highlightBoxes(num, false));
            inp.addEventListener('keydown', (e) => handleNav(e, inp));
            inp.addEventListener('click', function(e) { e.stopPropagation(); if(!this.classList.contains('locked')) this.select(); });
            return div;
        }

        function revealRandomHint(count) {
            setTimeout(() => {
                const inputs = Array.from(document.querySelectorAll('.letter-input'));
                const chars = [...new Set(inputs.map(i => i.dataset.real))];
                for(let i=0; i<count; i++) {
                    if(chars.length === 0) break;
                    const randIdx = Math.floor(Math.random() * chars.length);
                    const char = chars[randIdx]; chars.splice(randIdx, 1);
                    const num = charToNumberMap[char];
                    document.querySelectorAll(`.letter-input[data-number="${num}"]`).forEach(inp => {
                        inp.value = char; inp.classList.add('locked');
                    });
                }
            }, 500);
        }

        // --- HINT FUNCTION ---
        function useHint() {
            if (hintsRemaining <= 0) { showInfoPopup("Bantuan sudah habis!"); return; }
            let targetChar = null;
            if (lastFocusedInput && !lastFocusedInput.classList.contains('locked') && lastFocusedInput.value === "") {
                targetChar = lastFocusedInput.dataset.real;
            } else {
                const emptyInputs = Array.from(document.querySelectorAll('.letter-input')).filter(inp => !inp.classList.contains('locked') && inp.value === "");
                if (emptyInputs.length > 0) { const randomInput = emptyInputs[Math.floor(Math.random() * emptyInputs.length)]; targetChar = randomInput.dataset.real; }
            }
            if (targetChar) {
                hintsRemaining--; document.getElementById('hint-count').innerText = hintsRemaining;
                if(hintsRemaining === 0) document.getElementById('hint-btn').classList.add('opacity-50', 'cursor-not-allowed');
                const num = charToNumberMap[targetChar];
                document.querySelectorAll(`.letter-input[data-number="${num}"]`).forEach(inp => {
                    inp.value = targetChar; inp.classList.add('locked'); inp.classList.remove('animate-pop'); void inp.offsetWidth; inp.classList.add('animate-pop');
                });
                playUnlockSound();
            } else { showInfoPopup("Semua kotak sudah terisi!"); }
        }

        // --- SMART SKIP & INPUT LOGIC ---
        function handleInput(e, el) {
            e.stopPropagation(); let val = e.target.value.toUpperCase();
            if(!/^[A-Z]$/.test(val)) { if(val === "") syncInputs(el.dataset.number, ""); else el.value = ""; return; }
            playTypeSound(); syncInputs(el.dataset.number, val); focusNextUnlockedInput(el);
        }
        
        function focusNextUnlockedInput(currentInput) {
            const wrapper = currentInput.closest('.word-wrapper'); if(!wrapper) return;
            const inputs = Array.from(wrapper.querySelectorAll('.letter-input')); const currIdx = inputs.indexOf(currentInput);
            for(let i = currIdx + 1; i < inputs.length; i++) {
                // SKIP jika LOCKED atau SUDAH ADA ISI
                if(!inputs[i].classList.contains('locked') && inputs[i].value === "") { inputs[i].focus(); return; }
            }
        }

        function syncInputs(num, char) {
            document.querySelectorAll(`.letter-input[data-number="${num}"]`).forEach(inp => {
                if(!inp.classList.contains('locked')) { inp.value = char; if(char) { inp.classList.remove('animate-pop'); void inp.offsetWidth; inp.classList.add('animate-pop'); } }
            });
        }

        function highlightBoxes(num, isActive) {
            document.querySelectorAll(`.letter-input[data-number="${num}"]`).forEach(inp => {
                if(!inp.classList.contains('locked')) inp.style.backgroundColor = isActive ? "rgba(217, 70, 239, 0.15)" : "transparent";
                inp.nextElementSibling.style.color = isActive ? "#d946ef" : "#9ca3af";
            });
        }

        function handleNav(e, el) { if(e.key === "Backspace" && el.value === "") { e.preventDefault(); focusPrevUnlockedInput(el); } }
        function focusPrevUnlockedInput(currentInput) {
            const wrapper = currentInput.closest('.word-wrapper'); if(!wrapper) return;
            const inputs = Array.from(wrapper.querySelectorAll('.letter-input')); const currIdx = inputs.indexOf(currentInput);
            for(let i = currIdx - 1; i >= 0; i--) { if(!inputs[i].classList.contains('locked')) { inputs[i].focus(); setTimeout(() => inputs[i].select(), 0); return; } }
        }

        function checkAnswer() {
            const inputs = document.querySelectorAll('.letter-input'); let isCorrect = true; let levelErrors = 0;
            inputs.forEach(i => { if(!i.classList.contains('locked')) i.style.color = "#d946ef"; });
            inputs.forEach(inp => { if(inp.value !== inp.dataset.real) { isCorrect = false; levelErrors++; if(inp.value !== "") inp.style.color = "red"; } });
            if(!isCorrect) { if(levelErrors > 0) currentMistakes++; const counter = document.getElementById('mistake-counter'); counter.innerText = currentMistakes; counter.className = "text-2xl font-bold text-red-500 animate-pulse"; showToast(levelErrors); playBuzzer(); return; }
            playWinTune(); let stars = 0; if(currentMistakes === 0) stars = 3; else if(currentMistakes <= 3) stars = 2; else stars = 1;
            showWinModal(stars);
        }

        // --- ANIMASI BINTANG TERBANG ---
        function animateStarsCollection(earnedStars) {
            const startContainer = document.getElementById('modal-stars');
            const targetElement = document.getElementById('star-display-fixed');
            if(!startContainer || !targetElement) return;

            const startRect = startContainer.getBoundingClientRect();
            const targetRect = targetElement.getBoundingClientRect();
            const startX = startRect.left + startRect.width / 2;
            const startY = startRect.top + startRect.height / 2;
            const targetX = targetRect.left + targetRect.width / 2;
            const targetY = targetRect.top + targetRect.height / 2;

            for (let i = 0; i < earnedStars; i++) {
                const star = document.createElement('div');
                star.innerHTML = '<i class="fa-solid fa-star text-yellow-400 text-2xl drop-shadow-md"></i>';
                star.style.position = 'fixed'; star.style.left = `${startX}px`; star.style.top = `${startY}px`; star.style.zIndex = '10000'; star.style.transition = 'all 0.8s cubic-bezier(0.19, 1, 0.22, 1)'; star.style.transform = 'scale(0)';
                document.body.appendChild(star);

                setTimeout(() => {
                    star.style.transform = 'scale(1.5)';
                    setTimeout(() => { star.style.left = `${targetX}px`; star.style.top = `${targetY}px`; star.style.transform = 'scale(0.5)'; star.style.opacity = '0'; }, 100);
                    setTimeout(() => { star.remove(); updateTotalStarsUI(); targetElement.classList.add('scale-125'); setTimeout(() => targetElement.classList.remove('scale-125'), 200); playNotification(); }, 900);
                }, i * 200);
            }
        }

        function showWinModal(stars) {
            const modal = document.getElementById('win-modal'); const starsContainer = document.getElementById('modal-stars'); const btnNext = document.getElementById('btn-next-level'); const msg = document.getElementById('result-msg'); const emoji = document.getElementById('result-emoji');
            let starHtml = ''; for(let i=1; i<=3; i++) starHtml += `<i class="fa-solid fa-star ${i <= stars ? 'text-yellow-400 star-anim' : 'text-gray-300'}"></i>`;
            starsContainer.innerHTML = starHtml;
            const levelNum = currentLevelIdx + 1;
            
            if(!userProgress.stars[levelNum] || stars > userProgress.stars[levelNum]) { userProgress.stars[levelNum] = stars; }
            
            const totalStars = Object.values(userProgress.stars).reduce((a, b) => a + b, 0);
            const nextLevelReq = (levelNum) * 2; 

            if(stars >= 2) {
                emoji.innerText = "ğŸ‰"; document.getElementById('result-title').innerText = "LEVEL SELESAI!"; document.getElementById('result-title').className = "text-2xl font-bold text-green-600 mb-2";
                if(userProgress.unlockedLevel < levelNum + 1 && levelNum < 50) userProgress.unlockedLevel = levelNum + 1;
                
                if(levelNum === 50) { msg.innerText = "Selamat! Kamu menamatkan semua level!"; btnNext.classList.add('hidden-force'); }
                else if (totalStars >= nextLevelReq) { msg.innerText = "Hebat! Level selanjutnya terbuka."; btnNext.classList.remove('hidden-force'); } 
                else { msg.innerText = `Level ${levelNum+1} butuh total ${nextLevelReq} â­.`; btnNext.classList.add('hidden-force'); }
                
                setTimeout(() => animateStarsCollection(stars), 500);
            } else {
                emoji.innerText = "ğŸ’ª"; document.getElementById('result-title').innerText = "AYO COBA LAGI"; document.getElementById('result-title').className = "text-2xl font-bold text-orange-500 mb-2"; msg.innerText = "Minimal 2 bintang untuk lanjut."; btnNext.classList.add('hidden-force');
            }
            localStorage.setItem('sandiKataProgress', JSON.stringify(userProgress));
            modal.classList.remove('hidden-force');
        }

        function nextLevel() { document.getElementById('win-modal').classList.add('hidden-force'); loadLevel(currentLevelIdx + 2); }
        function restartLevel() { document.getElementById('win-modal').classList.add('hidden-force'); loadLevel(currentLevelIdx + 1); }
        function backToHome() { document.getElementById('game-screen').classList.add('hidden-force'); document.getElementById('game-screen').classList.remove('flex'); document.getElementById('win-modal').classList.add('hidden-force'); document.getElementById('home-screen').classList.remove('hidden-force'); renderLevelGrid(); }
        function showToast(count) { const wrapper = document.getElementById('error-toast-wrapper'); document.getElementById('toast-count').innerText = count; wrapper.classList.remove('hidden-force'); }
        function closeToast() { document.getElementById('error-toast-wrapper').classList.add('hidden-force'); }
        function showInfoPopup(msg) { const wrapper = document.getElementById('info-toast-wrapper'); document.getElementById('info-msg').innerText = msg; wrapper.classList.remove('hidden-force'); }
        function closeInfoToast() { document.getElementById('info-toast-wrapper').classList.add('hidden-force'); }
        function openResetModal() { const savedData = localStorage.getItem('sandiKataProgress'); if (!savedData) { playNotification(); showInfoPopup("Belum ada data permainan yang tersimpan."); return; } playAlertSound(); document.getElementById('reset-modal').classList.remove('hidden-force'); }
        function closeResetModal() { document.getElementById('reset-modal').classList.add('hidden-force'); }
        function confirmReset() { playDeleteSound(); localStorage.removeItem('sandiKataProgress'); userProgress = { unlockedLevel: 1, stars: {} }; renderLevelGrid(); updateTotalStarsUI(); closeResetModal(); showInfoPopup("Data berhasil direset!"); }

    </script>
</body>
</html>


